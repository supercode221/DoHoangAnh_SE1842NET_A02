<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DoHoangAnh_SE1842NET_A01_FE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <style>
        @@keyframes slide-in {
            from

        {
            transform: translateX(100%);
            opacity: 0;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }

        }

        @@keyframes slide-out {
            from

        {
            transform: translateX(0);
            opacity: 1;
        }

        to {
            transform: translateX(100%);
            opacity: 0;
        }

        }

        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }

        .animate-slide-out {
            animation: slide-out 0.3s ease-in;
        }

        #notificationList {
            max-height: 400px;
        }

            #notificationList::-webkit-scrollbar {
                width: 6px;
            }

            #notificationList::-webkit-scrollbar-track {
                background: #f1f1f1;
            }

            #notificationList::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 3px;
            }

                #notificationList::-webkit-scrollbar-thumb:hover {
                    background: #555;
                }
    </style>
</head>
<body>
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-lg border-b border-white/20 shadow-lg">
        <nav class="">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center transform hover:rotate-12 transition-transform duration-300">
                            <span class="text-2xl font-bold text-purple-600">FU</span>
                        </div>
                        <span class="text-2xl font-bold text-purple-400 tracking-wide">NMS</span>
                    </div>

                    <div class="hidden md:flex items-center space-x-8" id="navLink">
                        <a href="/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">News</a>
                    </div>

                    <a href="/Login" id="loginBtn" class="hidden md:block">
                        <button class="bg-white text-purple-600 px-6 py-2 rounded-full font-semibold hover:bg-pink-100 transform hover:scale-105 transition-all duration-300 shadow-lg">
                            Login
                        </button>
                    </a>

                    <div id="userMenu" class="hidden relative">
                        <button id="userMenuBtn" class="flex items-center space-x-2 bg-white/10 backdrop-blur-lg border border-white/20 px-4 py-2 rounded-full hover:bg-white/20 transition-all duration-300 hidden md:flex">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <span id="userEmailDisplay" class="text-black font-medium"></span>
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>

                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white backdrop-blur-lg border border-white rounded-lg shadow-lg overflow-hidden">
                            <button id="profileBtn" class="w-full px-4 py-3 text-left text-black hover:bg-gray-200 transition-colors duration-300 flex items-center space-x-2">
                                <span>Profile</span>
                            </button>
                            <button id="logoutBtn" class="w-full px-4 py-3 text-left text-black hover:bg-gray-200 transition-colors duration-300 flex items-center space-x-2">
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>

                    <div class="relative" id="notificationBell">
                        <button id="notificationBtn" class="relative p-2 text-purple-600 hover:text-purple-800 transition-colors duration-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>

                            <span id="notificationDot" class="hidden absolute top-1 right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>

                            <span id="notificationCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
                        </button>

                        <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[500px] overflow-hidden flex flex-col">
                            <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-purple-50">
                                <h3 class="font-semibold text-gray-800">Notifications</h3>
                                <button id="clearAllNotifications" class="text-xs text-purple-600 hover:text-purple-800 font-medium">
                                    Clear All
                                </button>
                            </div>

                            <div id="notificationList" class="overflow-y-auto flex-1">
                                
                            </div>

                            <div id="emptyNotifications" class="p-8 text-center text-gray-400">
                                <svg class="w-16 h-16 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                                </svg>
                                <p class="text-sm">No notifications yet</p>
                            </div>
                        </div>
                    </div>

                    <button class="md:hidden text-white" id="mobileMenuBtn">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>

                <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4">
                    <div class="flex flex-col space-y-4">
                        <a href="/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">News</a>

                        <a href="/Login" id="mobileLoginBtn">
                            <button class="w-full bg-white text-purple-600 px-6 py-2 rounded-full font-semibold hover:bg-pink-100 transition-all duration-300 shadow-lg">
                                Login
                            </button>
                        </a>

                        <div id="mobileUserInfo" class="hidden">
                            <div class="bg-white/10 backdrop-blur-lg border border-white/20 rounded-lg p-4">
                                <div class="flex items-center space-x-2 mb-3">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    <span id="mobileUserEmail" class="text-black font-medium"></span>
                                </div>
                                <button id="mobileProfileBtn" class="w-full px-4 py-2 mb-2 text-white bg-purple-500 hover:bg-purple-700 rounded-lg transition-colors duration-300 flex items-center justify-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    <span>Profile</span>
                                </button>
                                <button id="mobileLogoutBtn" class="w-full px-4 py-2 text-white bg-red-500 hover:bg-red-700 rounded-lg transition-colors duration-300 flex items-center justify-center space-x-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                    </svg>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="">
        <main role="main" class="flex-grow flex items-center justify-center p-8">
            @RenderBody()
        </main>
    </div>

    <footer class="bg-black/30 backdrop-blur-lg border-t border-white/20 text-white">
        <div class="max-w-7xl mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="space-y-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-fit p-2 h-10 bg-white rounded-lg flex items-center justify-center">
                            <span class="text-2xl font-bold text-purple-600">FUNMS</span>
                        </div>
                    </div>
                    <p class="text-white/80 text-sm leading-relaxed">
                        Creating beautiful digital experiences that inspire and engage users worldwide.
                    </p>
                    <div class="flex space-x-4 pt-2">
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-colors duration-300">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                            </svg>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-colors duration-300">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
                            </svg>
                        </a>
                        <a href="#" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-colors duration-300">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm4.441 16.892c-2.102.144-6.784.144-8.883 0C5.282 16.736 5.017 15.622 5 12c.017-3.629.285-4.736 2.558-4.892 2.099-.144 6.782-.144 8.883 0C18.718 7.264 18.982 8.378 19 12c-.018 3.629-.285 4.736-2.559 4.892zM10 9.658l4.917 2.338L10 14.342V9.658z" />
                            </svg>
                        </a>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">About Us</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Services</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Portfolio</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Blog</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-4">Support</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Help Center</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Contact Us</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Privacy Policy</a></li>
                        <li><a href="#" class="text-white/80 hover:text-white transition-colors duration-300">Terms of Service</a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold mb-4">Newsletter</h3>
                    <p class="text-white/80 text-sm mb-4">Subscribe to get the latest updates and news.</p>
                    <div class="flex">
                        <input type="email" placeholder="Your email" class="flex-grow px-4 py-2 rounded-l-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50">
                        <button class="px-6 py-2 bg-white text-purple-600 rounded-r-lg font-semibold hover:bg-pink-100 transition-colors duration-300">
                            Join
                        </button>
                    </div>
                </div>
            </div>

            <div class="pt-8 border-t border-white/20 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <p class="text-white/60 text-sm">© 2025 FUNMS. All rights reserved.</p>
                <div class="flex space-x-6 text-sm">
                    <a href="#" class="text-white/60 hover:text-white transition-colors duration-300">Privacy</a>
                    <a href="#" class="text-white/60 hover:text-white transition-colors duration-300">Terms</a>
                    <a href="#" class="text-white/60 hover:text-white transition-colors duration-300">Cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem("userEmail");
            const userRole = localStorage.getItem("userRole");

            const navLink = document.getElementById('navLink');
            const loginBtn = document.getElementById('loginBtn');
            const userMenu = document.getElementById('userMenu');
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userDropdown = document.getElementById('userDropdown');
            const logoutBtn = document.getElementById('logoutBtn');
            const profileBtn = document.getElementById('profileBtn');

            const mobileLoginBtn = document.getElementById('mobileLoginBtn');
            const mobileUserInfo = document.getElementById('mobileUserInfo');
            const mobileUserEmail = document.getElementById('mobileUserEmail');
            const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
            const mobileProfileBtn = document.getElementById('mobileProfileBtn');

            if (userEmail && userEmail !== "" && userEmail !== "null") {
                loginBtn.style.display = 'none';
                userMenu.classList.remove('hidden');
                userEmailDisplay.textContent = userEmail;

                mobileLoginBtn.style.display = 'none';
                mobileUserInfo.classList.remove('hidden');
                mobileUserEmail.textContent = userEmail;
            } else {
                loginBtn.style.display = 'block';
                userMenu.classList.add('hidden');

                mobileLoginBtn.style.display = 'block';
                mobileUserInfo.classList.add('hidden');
            }

            navLink.innerHTML = "";

            if (userRole === "Admin") {
                navLink.innerHTML = `
                    <a href="/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        News
                    </a>
                    <a href="/Admin/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        User Management
                    </a>
                    <a href="/Admin/Dashboard" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        Dashboard
                    </a>
                    <a href="/Admin/Log" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        System Log
                    </a>
                `;
            } else if (userRole === "Staff") {
                navLink.innerHTML = `
                    <a href="/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        News
                    </a>
                    <a href="/Staff/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        News Article Management
                    </a>
                    <a href="/Staff/Tag" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        Tag Management
                    </a>
                    <a href="/Staff/Category" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        Category Management
                    </a>
                `;
            } else {
                navLink.innerHTML = `
                    <a href="/Index" class="text-purple-600 hover:text-purple-800 transition-colors duration-300 font-medium">
                        News
                    </a>
                `;
            }

            let dropdownTimeout;

            userMenuBtn.addEventListener('mouseenter', () => {
                clearTimeout(dropdownTimeout);
                userDropdown.classList.remove('hidden');
            });

            userDropdown.addEventListener('mouseleave', () => {
                userDropdown.classList.add('hidden');
            });

            userMenuBtn.addEventListener('click', () => {
                userDropdown.classList.toggle('hidden');
            });

            function logout() {
                localStorage.clear();
                window.location.reload();
            }

            logoutBtn.addEventListener('click', logout);
            mobileLogoutBtn.addEventListener('click', logout);

            profileBtn.addEventListener('click', () => {
                window.location.href = '/Profile';
            });

            mobileProfileBtn.addEventListener('click', () => {
                window.location.href = '/Profile';
            });

            document.addEventListener('click', (e) => {
                if (!userMenu.contains(e.target)) {
                    userDropdown.classList.add('hidden');
                }
            });
        });

        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        async function refreshAccessToken() {
            const refreshToken = localStorage.getItem("refreshToken");
            const accessToken = localStorage.getItem("accessToken");

            const response = await fetch("https://localhost:7000/api/auth/refresh", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ accessToken, refreshToken })
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem("accessToken", data.data.accessToken);
                localStorage.setItem("refreshToken", data.data.refreshToken);
                console.log("Token refreshed successfully.");
            } else {
                console.warn("Refresh failed — redirecting to login.");
                localStorage.clear();
                window.location.href = "/Login";
            }
        }

        async function ensureValidAccessToken() {
            let accessToken = localStorage.getItem("accessToken");
            if (!accessToken || isTokenExpired(accessToken)) {
                console.log("Access token expired, refreshing...");
                await refreshAccessToken();
                accessToken = localStorage.getItem("accessToken");
            }
            return accessToken;
        }

        function isTokenExpired(token) {
            const payload = JSON.parse(atob(token.split('.')[1]));
            const expiry = payload.exp * 1000;
            return Date.now() > expiry;
        }
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>